<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>wireleap</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.9.1/dist/cdn.min.js"></script>
  <style>
    .scroll-container::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }
    .scroll-container::-webkit-scrollbar-thumb {
      background-color: lightgrey;
      border-radius: 5px;
    }
    .scroll-container::-webkit-scrollbar-track {
      margin-top: 5px;
      margin-bottom: 5px;
    }
  </style>
</head>

<body>
<div x-data="alpineInstance()" x-init="initialize()">

<div class="relative min-h-screen flex flex-col">
  <div class="flex-grow w-full mx-auto lg:flex">

    <div class="flex-1 min-w-0 bg-white xl:flex">
      <!-- left column -->
      <div class="lg:w-1/3 border-b border-gray-200 xl:border-b-0 xl:flex-shrink-0 xl:border-r xl:border-gray-200 bg-white">
        <div class="h-full p-6">
          <div class="h-full relative space-y-3 scroll-container overflow-y-auto overflow-hidden pb-10" style="min-height: 12rem">

            <a class="text-xs text-blue-600" href="http://alonswartz-temp.s3-website-us-east-1.amazonaws.com/wireleap.com/docs/client-api/" target="_blank">API Spec</a>

            <p class="text-xs text-gray-900 font-medium uppercase pb-2 pt-4">Core</p>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/version</summary>
              <template x-if="error.version"><p class="p-1 bg-red-200" x-text="error.version"></template>
              <template x-if="cache.version">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>version: <span x-text="cache.version.version"></span></li>
                </ul>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/status</summary>
              <template x-if="error.status"><p class="p-1 bg-red-200" x-text="error.status"></template>
              <template x-if="cache.status">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>home: <span x-text="cache.status.home"></span></li>
                  <li>pid: <span x-text="cache.status.pid"></span></li>
                  <li>state: <span x-text="cache.status.state"></span></li>
                  <li>broker.active_circuit: <span x-text="cache.status.broker.active_circuit"></span></li>
                  <li>upgrade.required: <span x-text="cache.status.upgrade.required"></span></li>
                </ul>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/config</summary>
              <template x-if="error.config"><p class="p-1 bg-red-200" x-text="error.config"></template>
              <template x-if="cache.config">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>address: <span x-text="cache.config.address"></span></li>
                  <li>broker.address: <span x-text="cache.config.broker.address"></span></li>
                  <li>broker.accesskey.use_on_demand: <span x-text="cache.config.broker.accesskey.use_on_demand"></span></li>
                  <li>broker.circuit.timeout: <span x-text="cache.config.broker.circuit.timeout"></span></li>
                  <li>broker.circuit.hops: <span x-text="cache.config.broker.circuit.hops"></span></li>
                  <li>broker.circuit.whitelist: <span x-text="cache.config.broker.circuit.whitelist"></span></li>
                  <li>forwarders.socks.address: <span x-text="cache.config.forwarders.socks.address"></span></li>
                  <li>forwarders.tun.address: <span x-text="cache.config.forwarders.tun.address"></span></li>
                </ul>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/runtime</summary>
              <template x-if="error.runtime"><p class="p-1 bg-red-200" x-text="error.runtime"></template>
              <template x-if="cache.runtime">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>versions.software: <span x-text="cache.runtime.versions.software"></span></li>
                  <li>versions.api: <span x-text="cache.runtime.versions.api"></span></li>
                  <li>versions.client-contract: <span x-text="cache.runtime.versions['client-contract']"></span></li>
                  <li>versions.client-dir: <span x-text="cache.runtime.versions['client-dir']"></span></li>
                  <li>versions.client-relay: <span x-text="cache.runtime.versions['client-relay']"></span></li>
                  <li>upgrade.supported: <span x-text="cache.runtime.upgrade.supported"></span></li>
                  <li>build.gitcommit: <span x-text="cache.runtime.build.gitcommit"></span></li>
                  <li>build.goversion: <span x-text="cache.runtime.build.goversion"></span></li>
                  <li>build.time: <span x-text="cache.runtime.build.time"></span></li>
                  <li>build.flags: <span x-text="cache.runtime.build.flags"></span></li>
                  <li>platform.os: <span x-text="cache.runtime.platform.os"></span></li>
                  <li>platform.arch: <span x-text="cache.runtime.platform.arch"></span></li>
                </ul>
              </template>
            </details>

            <p class="text-xs text-gray-900 font-medium uppercase pb-2 pt-4">Resources</p>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/accesskeys</summary>
              <template x-if="error.accesskeys"><p class="p-1 bg-red-200" x-text="error.accesskeys"></template>
              <template x-if="cache.accesskeys">
                <template x-for="accesskey in cache.accesskeys">
                  <ul class="ml-1 p-2 border-l-2 border-blue-200">
                    <li>contract: <span x-text="accesskey.contract"></span></li>
                    <li>duration: <span x-text="accesskey.duration"></span></li>
                    <li>expiration: <span x-text="accesskey.expiration"></span></li>
                    <li>state: <span x-text="accesskey.state"></span></li>
                  </ul>
                </template>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/relays</summary>
              <template x-if="error.relays"><p class="p-1 bg-red-200" x-text="error.relays"></template>
              <template x-if="cache.relays">
                <template x-for="relay in cache.relays">
                  <ul class="ml-1 p-2 border-l-2 border-blue-200">
                    <li>role: <span x-text="relay.role"></span></li>
                    <li>address: <span x-text="relay.address"></span></li>
                    <li>pubkey: <span x-text="relay.pubkey"></span></li>
                    <li>selectable: <span x-text="relay.selectable"></span></li>
                    <li>versions.software: <span x-text="relay.versions.software"></span></li>
                    <li>versions.client-relay: <span x-text="relay.versions['client-relay']"></span></li>
                  </ul>
                </template>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/contract</summary>
              <template x-if="error.contract"><p class="p-1 bg-red-200" x-text="error.contract"></template>
              <template x-if="cache.contract">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>pubkey: <span x-text="cache.contract.pubkey"></span></li>
                  <li>version: <span x-text="cache.contract.version"></span></li>
                  <li>endpoint: <span x-text="cache.contract.endpoint"></span></li>
                  <template x-for="proof_of_funding in cache.contract.proof_of_funding">
                    <ul class="py-2">
                      <li>proof_of_funding.type: <span x-text="proof_of_funding.type"></span></li>
                      <li>proof_of_funding.endpoint: <span x-text="proof_of_funding.endpoint"></span></li>
                      <li>proof_of_funding.pubkey: <span x-text="proof_of_funding.pubkey"></span></li>
                    </ul>
                  </template>
                  <li>servicekey.duration: <span x-text="cache.contract.servicekey.duration"></span></li>
                  <li>servicekey.currency: <span x-text="cache.contract.servicekey.currency"></span></li>
                  <li>servicekey.value: <span x-text="cache.contract.servicekey.value"></span></li>
                  <li>directory.endpoint: <span x-text="cache.contract.directory.endpoint"></span></li>
                  <li>directory.public_key: <span x-text="cache.contract.directory.public_key"></span></li>
                  <li>metadata.operator: <span x-text="cache.contract.metadata.operator"></span></li>
                  <li>metadata.operator_url: <span x-text="cache.contract.metadata.operator_url"></span></li>
                  <li>metadata.name: <span x-text="cache.contract.metadata.name"></span></li>
                  <li>metadata.terms_of_service: <span x-text="cache.contract.metadata.terms_of_service"></span></li>
                  <li>metadata.privacy_policy: <span x-text="cache.contract.metadata.privacy_policy"></span></li>
                </ul>
              </template>
            </details>

            <p class="text-xs text-gray-900 font-medium uppercase pb-2 pt-4">Forwarders</p>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/forwarders/socks</summary>
              <template x-if="error.forwarders_socks"><p class="p-1 bg-red-200" x-text="error.forwarders_socks"></template>
              <template x-if="cache.forwarders_socks">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>pid: <span x-text="cache.forwarders_socks.pid"></span></li>
                  <li>state: <span x-text="cache.forwarders_socks.state"></span></li>
                  <li>address: <span x-text="cache.forwarders_socks.address"></span></li>
                  <li>binary.ok: <span x-text="cache.forwarders_socks.binary.ok"></span></li>
                  <li>binary.state.exists: <span x-text="cache.forwarders_socks.binary.state.exists"></span></li>
                  <li>binary.state.chmod_x: <span x-text="cache.forwarders_socks.binary.state.chmod_x"></span></li>
                </ul>
              </template>
            </details>

            <details class="text-xs whitespace-nowrap cursor-pointer">
              <summary class="text-gray-600 font-light">/api/forwarders/tun</summary>
              <template x-if="error.forwarders_tun"><p class="p-1 bg-red-200" x-text="error.forwarders_tun"></template>
              <template x-if="cache.forwarders_tun">
                <ul class="ml-1 p-2 border-l-2 border-blue-200">
                  <li>pid: <span x-text="cache.forwarders_tun.pid"></span></li>
                  <li>state: <span x-text="cache.forwarders_tun.state"></span></li>
                  <li>address: <span x-text="cache.forwarders_tun.address"></span></li>
                  <li>binary.ok: <span x-text="cache.forwarders_tun.binary.ok"></span></li>
                  <li>binary.state.exists: <span x-text="cache.forwarders_tun.binary.state.exists"></span></li>
                  <li>binary.state.chown_0: <span x-text="cache.forwarders_tun.binary.state.chown_0"></span></li>
                  <li>binary.state.chmod_x: <span x-text="cache.forwarders_tun.binary.state.chmod_x"></span></li>
                  <li>binary.state.chmod_us: <span x-text="cache.forwarders_tun.binary.state.chmod_us"></span></li>
                </ul>
              </template>
            </details>

          </div>
        </div>
      </div>

      <!-- main area -->
      <div class="bg-white lg:min-w-0 lg:flex-1">
        <div class="h-full p-6">
          <!-- Start main area-->
          <div class="relative h-screen" style="min-height: 36rem">

            <div>
              <p class="text-xs text-gray-900 font-medium uppercase pb-2 pt-4">Socks</p>
              <template x-if="cache.forwarders_socks">
                <div class="text-xs">
                  <p>state: <span x-text="cache.forwarders_socks.state"></span></p>
                  <button @click="apiPostJson('/api/forwarders/socks/start')" class="border border-gray-300 rounded shadow-sm text-xs px-2 pt-1.5 pb-1 items-center justify-center hover:bg-gray-50">start</button>
                  <button @click="apiPostJson('/api/forwarders/socks/stop')" class="border border-gray-300 rounded shadow-sm text-xs px-2 pt-1.5 pb-1 items-center justify-center hover:bg-gray-50">stop</button>
                </div>
              </template>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- right column -->
    <div class="lg:w-1/3 bg-gray-50 lg:flex-shrink-0 lg:border-l lg:border-gray-200">
      <div class="h-full p-6 lg:w-full">
        <div class="relative space-y-5" style="min-height: 16rem">
          <div>
            <p class="text-sm font-bold py-2">Controller</p>
            <template x-if="error.log">
              <p class="p-1 bg-red-200 text-xs" x-text="error.log">
            </template>
            <template x-if="cache.log">
              <pre class="w-full max-h-52 overflow-y-auto text-xs scroll-container" x-text="cache.log"></pre>
            </template>
          </div>

          <div>
            <p class="text-sm font-bold py-2">SOCKS Forwarder</p>
            <template x-if="error.forwarders_socks_log">
              <p class="p-1 bg-red-200 text-xs" x-text="error.forwarders_socks_log">
            </template>
            <template x-if="cache.forwarders_socks_log">
              <pre class="w-full max-h-52 overflow-y-auto text-xs scroll-container" x-text="cache.forwarders_socks_log"></pre>
            </template>
          </div>

          <div>
            <p class="text-sm font-bold py-2">TUN Forwarder</p>
            <template x-if="error.forwarders_tun_log">
              <p class="p-1 bg-red-200 text-xs" x-text="error.forwarders_tun_log">
            </template>
            <template x-if="cache.forwarders_tun_log">
              <pre class="w-full max-h-52 overflow-y-auto text-xs scroll-container" x-text="cache.forwarders_tun_log"></pre>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

</div>
</body>

<script type="text/javascript">
function alpineInstance() {
  return {
    cache: {},
    error: {},
    initialize() {
      this.apiGetJson("/api/version");
      this.apiGetJson("/api/status");
      this.apiGetText("/api/log");
      this.apiGetJson("/api/config");
      this.apiGetJson("/api/runtime");
      this.apiGetJson("/api/accesskeys");
      this.apiGetJson("/api/relays");
      this.apiGetJson("/api/contract");
      this.apiGetJson("/api/forwarders/socks");
      this.apiGetText("/api/forwarders/socks/log");
      this.apiGetJson("/api/forwarders/tun");
      this.apiGetText("/api/forwarders/tun/log");
    },
    apiPostJson(uri, data={}) {
      let options = { method: 'POST', headers: {'Content-Type': 'applications/json'}, body: JSON.stringify(data) };
      fetch(uri, options)
        .then(response => {
          if (response.ok) return response.json();
          throw response;
        })
        .then(data => {
          console.log(uri);
          console.log(data);

          if (uri.startsWith("/api/forwarders/socks")) {
            this.cache.forwarders_socks = data;
            this.apiGetText("/api/forwarders/socks/log");
          }

          //this.cache[cacheKey] = data;
          //this.error[cacheKey] = null;
          //console.log(data);
        })
        .catch(error => {
          console.log(error);
          //this.cache[cacheKey] = null;
          //error.text().then(data => this.error[cacheKey] = data );
        })
        .finally(() => {
          //console.log('finally')
        });

    },
    apiGetJson(uri) {
      let cacheKey = uri.replaceAll("/","_").replace('_api_','');
      fetch(uri)
        .then(response => {
          if (response.ok) return response.json();
          throw response;
        })
        .then(data => {
          this.cache[cacheKey] = data;
          this.error[cacheKey] = null;
          //console.log(data);
        })
        .catch(error => {
          this.cache[cacheKey] = null;
          error.text().then(data => this.error[cacheKey] = data );
        })
        .finally(() => {
          //console.log('finally')
        });
    },

    apiGetText(uri) {
      let cacheKey = uri.replaceAll("/","_").replace('_api_','');
      fetch(uri)
        .then(response => {
          if (response.ok) return response.text();
          throw response;
        })
        .then(data => {
          this.cache[cacheKey] = data;
          this.error[cacheKey] = null;
          //console.log(data);
        })
        .catch(error => {
          this.cache[cacheKey] = null;
          error.text().then(data => this.error[cacheKey] = data );
        })
        .finally(() => {
          //console.log('finally')
        });
    },

  }
}
</script>

</html>
